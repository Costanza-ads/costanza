{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/esant/OneDrive/%C3%81rea%20de%20Trabalho/costanza-main/frontend-next/src/lib/axiosInstance.ts"],"sourcesContent":["// lib/axiosInstance.ts\r\nimport axios from 'axios';\r\n\r\n// 圷 CORREﾃﾃグ DO 404: Removendo a barra final da BASE_URL\r\nconst BASE_URL = 'http://localhost:8000/api/v1'; \r\nconst TOKEN_REFRESH_URL = 'http://localhost:8000/api/token/refresh/';\r\n\r\n// 圷 NOVO REFRESH TOKEN (Para inicializaﾃｧﾃ｣o)\r\nconst INITIAL_REFRESH_TOKEN = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoicmVmcmVzaCIsImV4cCI6MTc2MTEzMzMyNCwiaWF0IjoxNzYxMDQ2OTI0LCJqdGkiOiIxMWE0NWYzNTA3YTY0YWU0OWYxYzE1YTk3MzA1MjJmMyIsInVzZXJfaWQiOiIzIn0.ooFCw0-NZ_O9lQgqAOLyev_nwRSAjC3uAFTnxoQfnT0\";\r\n\r\n// 庁 Configuraﾃｧﾃ｣o inicial: SALVA o refresh token APENAS NO CLIENTE (Evita ReferenceError)\r\nif (typeof window !== 'undefined' && !localStorage.getItem('refreshToken')) {\r\n    localStorage.setItem('refreshToken', INITIAL_REFRESH_TOKEN);\r\n}\r\n\r\n// Crie a instﾃ｢ncia base do Axios\r\nconst axiosInstance = axios.create({\r\n  baseURL: BASE_URL,\r\n  headers: {\r\n    'Content-Type': 'application/json',\r\n  },\r\n});\r\n\r\n// Variﾃ｡veis de controle\r\nlet isRefreshing = false;\r\nlet failedQueue: { resolve: (value: any) => void; reject: (reason?: any) => void; }[] = [];\r\n\r\n// Funﾃｧﾃ｣o que processa a fila de requisiﾃｧﾃｵes que falharam\r\nconst processQueue = (error: any, token: string | null = null) => {\r\n  failedQueue.forEach(prom => {\r\n    if (error) {\r\n      prom.reject(error);\r\n    } else if (token) {\r\n      prom.resolve(token); \r\n    }\r\n  });\r\n  failedQueue = [];\r\n};\r\n\r\n// -------------------------------------------------------------\r\n// 1. INTERCEPTOR DE REQUISIﾃﾃグ (ANEXA O ACCESS TOKEN ANTES DE ENVIAR)\r\n// -------------------------------------------------------------\r\naxiosInstance.interceptors.request.use(\r\n    (config) => {\r\n        let token = null;\r\n\r\n        // 圷 CORREﾃﾃグ DO LOCALSTORAGE: Acesso apenas no lado do cliente\r\n        if (typeof window !== 'undefined') {\r\n            token = localStorage.getItem('accessToken');\r\n        }\r\n        \r\n        if (token) {\r\n            config.headers.Authorization = `Bearer ${token}`;\r\n        }\r\n        return config;\r\n    },\r\n    (error) => {\r\n        return Promise.reject(error);\r\n    }\r\n);\r\n\r\n\r\n// -------------------------------------------------------------\r\n// 2. INTERCEPTOR DE RESPOSTA (DETECTA 401 E RENOVA)\r\n// -------------------------------------------------------------\r\naxiosInstance.interceptors.response.use(\r\n  (response) => response,\r\n  async (error) => {\r\n    const originalRequest = error.config;\r\n    const isClient = typeof window !== 'undefined';\r\n\r\n    // Verifica se ﾃｩ um 401 E que nﾃ｣o seja a prﾃｳpria requisiﾃｧﾃ｣o de refresh\r\n    if (error.response?.status === 401 && !originalRequest._retry) {\r\n      originalRequest._retry = true;\r\n\r\n      // Obtﾃｩm o refresh token\r\n      const REFRESH_TOKEN = isClient ? localStorage.getItem('refreshToken') : null;\r\n      \r\n      if (!REFRESH_TOKEN) {\r\n          return Promise.reject(\"Refresh token nﾃ｣o encontrado. Sessﾃ｣o expirada.\");\r\n      }\r\n\r\n      if (isRefreshing) {\r\n        // Adiciona requisiﾃｧﾃｵes ﾃ fila\r\n        return new Promise((resolve, reject) => {\r\n            failedQueue.push({ resolve, reject });\r\n        }).then((token: any) => {\r\n            originalRequest.headers.Authorization = `Bearer ${token}`;\r\n            return axiosInstance(originalRequest);\r\n        }).catch(err => {\r\n            return Promise.reject(err);\r\n        });\r\n      }\r\n\r\n      isRefreshing = true;\r\n\r\n      try {\r\n        // Envia o refresh token para o endpoint do Django\r\n        const response = await axios.post(TOKEN_REFRESH_URL, {\r\n            refresh: REFRESH_TOKEN,\r\n        });\r\n\r\n        const { access: newAccessToken, refresh: newRefreshToken } = response.data;\r\n\r\n        // 圷 CORREﾃﾃグ DO LOCALSTORAGE: Salva os novos tokens apenas no cliente\r\n        if (isClient) {\r\n            localStorage.setItem('accessToken', newAccessToken);\r\n            if (newRefreshToken) {\r\n                 localStorage.setItem('refreshToken', newRefreshToken);\r\n            }\r\n        }\r\n\r\n        // Atualiza cabeﾃｧalhos\r\n        axiosInstance.defaults.headers.common['Authorization'] = `Bearer ${newAccessToken}`;\r\n        originalRequest.headers.Authorization = `Bearer ${newAccessToken}`;\r\n\r\n        // Processa a fila e repete a requisiﾃｧﾃ｣o original\r\n        processQueue(null, newAccessToken);\r\n        return axiosInstance(originalRequest);\r\n\r\n      } catch (refreshError) {\r\n        // Falha na renovaﾃｧﾃ｣o: Limpa tokens e forﾃｧa logout\r\n        if (isClient) {\r\n            localStorage.removeItem('accessToken');\r\n            localStorage.removeItem('refreshToken');\r\n        }\r\n        processQueue(refreshError);\r\n        return Promise.reject(refreshError);\r\n      } finally {\r\n        isRefreshing = false;\r\n      }\r\n    }\r\n\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\nexport default axiosInstance;"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 129, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/esant/OneDrive/%C3%81rea%20de%20Trabalho/costanza-main/frontend-next/src/components/user-fetcher.tsx"],"sourcesContent":["// app/components/UserFetcher.tsx\r\n\r\n\"use client\";\r\n\r\nimport React, { useState, useEffect } from 'react';\r\n// Importa a instﾃ｢ncia configurada\r\nimport axiosInstance from '@/lib/axiosInstance'; \r\nimport axios from 'axios'; // Importa o Axios para tratamento de erros\r\n\r\n// Definiﾃｧﾃ｣o da Tipagem CORRIGIDA para o Objeto de Perfil\r\ninterface UserProfile {\r\n  id: number;\r\n  user: number; \r\n  nome: string;\r\n  arroba: string;\r\n  stack: string;\r\n  bio: string;\r\n  skills: string;\r\n  xp: number;\r\n  exercicios_concluidos: number;\r\n  trilhas_concluidas: number;\r\n  dias_conectados: number;\r\n}\r\n\r\nconst UserFetcher: React.FC = () => {\r\n  const [profiles, setProfiles] = useState<UserProfile[] | null>(null);\r\n  const [isLoading, setIsLoading] = useState<boolean>(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  // 圷 CORREﾃﾃグ DO 404: O PATH RELATIVO DEVE COMEﾃ②R COM BARRA.\r\n  const DJANGO_API_PATH: string = '/users/profile/'; \r\n\r\n  useEffect(() => {\r\n    const fetchProfiles = async () => {\r\n      try {\r\n        // Usa axiosInstance.get - A autenticaﾃｧﾃ｣o e renovaﾃｧﾃ｣o sﾃ｣o automﾃ｡ticas.\r\n        const response = await axiosInstance.get(DJANGO_API_PATH);\r\n        \r\n        let data = response.data;\r\n        \r\n        // Ajuste para garantir que 'data' seja um array\r\n        if (data && !Array.isArray(data)) {\r\n            data = [data]; \r\n        }\r\n\r\n        setProfiles(data as UserProfile[]); \r\n        \r\n      } catch (err) {\r\n        let errorMessage = \"Ocorreu um erro desconhecido.\";\r\n        \r\n        if (axios.isAxiosError(err)) {\r\n            if (err.response?.status === 404) {\r\n                // 圷 Se for 404, confirma problema na URL\r\n                errorMessage = `Erro 404: O caminho '${DJANGO_API_PATH}' nﾃ｣o foi encontrado no servidor.`;\r\n            } else if (err.response?.status === 401) {\r\n                // Se a renovaﾃｧﾃ｣o falhou\r\n                errorMessage = \"Sessﾃ｣o expirada. O Refresh Token nﾃ｣o conseguiu renovar o acesso. Faﾃｧa login novamente.\";\r\n            } else if (err.response) {\r\n                 errorMessage = `Erro HTTP ${err.response.status}: ${JSON.stringify(err.response.data)}`;\r\n            }\r\n        } else if (err instanceof Error) {\r\n            errorMessage = err.message;\r\n        }\r\n        \r\n        setError(errorMessage);\r\n        \r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchProfiles();\r\n  }, []);\r\n\r\n  // 3. Renderizaﾃｧﾃ｣o\r\n  if (isLoading) {\r\n    return <p>Carregando dados do Django...</p>;\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div style={{ padding: '10px', border: '1px solid red', color: 'red' }}>\r\n        <h3>Erro ao Carregar Perfis</h3>\r\n        <p>{error}</p>\r\n        <p>URL Base: <code>{axiosInstance.defaults.baseURL}</code></p>\r\n        <p>Caminho Solicitado: <code>{DJANGO_API_PATH}</code></p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div>\r\n      <h2>Lista de Perfis (via Django API)</h2>\r\n      \r\n      {profiles && profiles.length > 0 ? (\r\n        <ul>\r\n          {profiles.map((profile) => (\r\n            // Renderizaﾃｧﾃ｣o dos dados\r\n            <li key={profile.id} style={{ marginBottom: '20px', border: '1px solid #ccc', padding: '10px' }}>\r\n              <strong>ID do Perfil:</strong> {profile.id} <br/>\r\n              <strong>Nome Completo:</strong> {profile.nome} <br/>\r\n              <strong>Arroba:</strong> {profile.arroba} <br/>\r\n              <strong>Stack:</strong> {profile.stack} <br/>\r\n              <strong>XP:</strong> {profile.xp} <br/>\r\n              {/* <strong>Dias Conectados:</strong> {profile.dias_conectados} <br/>\r\n              <strong>Trilhas Concluﾃｭdas:</strong> {profile.trilhas_concluidas} <br/> */}\r\n              <strong>Skills:</strong> {profile.skills} <br/>\r\n              <strong>Bio:</strong> {profile.bio} <br/>\r\n              {/* <strong>Exercﾃｭcios Concluﾃｭdos:</strong> {profile.exercicios_concluidos} */}\r\n            </li>\r\n          ))}\r\n        </ul>\r\n      ) : (\r\n        <p>Nenhum perfil encontrado na API.</p>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default UserFetcher;"],"names":[],"mappings":"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","debugId":null}}]
}