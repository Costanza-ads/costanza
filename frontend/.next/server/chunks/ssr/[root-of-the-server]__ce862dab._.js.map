{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/esant/OneDrive/%C3%81rea%20de%20Trabalho/costanzaVE-master/frontend-next/src/lib/axiosInstance.ts"],"sourcesContent":["// lib/axiosInstance.ts\nimport axios from 'axios';\n\n// 圷 CORREﾃﾃグ DO 404: Removendo a barra final da BASE_URL\nconst BASE_URL = 'http://localhost:8000/api/v1'; \nconst TOKEN_REFRESH_URL = 'http://localhost:8000/api/token/refresh/';\n\n// 圷 NOVO REFRESH TOKEN (Para inicializaﾃｧﾃ｣o)\nconst INITIAL_REFRESH_TOKEN = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoicmVmcmVzaCIsImV4cCI6MTc2MTEzMzMyNCwiaWF0IjoxNzYxMDQ2OTI0LCJqdGkiOiIxMWE0NWYzNTA3YTY0YWU0OWYxYzE1YTk3MzA1MjJmMyIsInVzZXJfaWQiOiIzIn0.ooFCw0-NZ_O9lQgqAOLyev_nwRSAjC3uAFTnxoQfnT0\";\n\n// 庁 Configuraﾃｧﾃ｣o inicial: SALVA o refresh token APENAS NO CLIENTE (Evita ReferenceError)\nif (typeof window !== 'undefined' && !localStorage.getItem('refreshToken')) {\n    localStorage.setItem('refreshToken', INITIAL_REFRESH_TOKEN);\n}\n\n// Crie a instﾃ｢ncia base do Axios\nconst axiosInstance = axios.create({\n  baseURL: BASE_URL,\n  headers: {\n    'Content-Type': 'application/json',\n  },\n});\n\n// Variﾃ｡veis de controle\nlet isRefreshing = false;\nlet failedQueue: { resolve: (value: any) => void; reject: (reason?: any) => void; }[] = [];\n\n// Funﾃｧﾃ｣o que processa a fila de requisiﾃｧﾃｵes que falharam\nconst processQueue = (error: any, token: string | null = null) => {\n  failedQueue.forEach(prom => {\n    if (error) {\n      prom.reject(error);\n    } else if (token) {\n      prom.resolve(token); \n    }\n  });\n  failedQueue = [];\n};\n\n// -------------------------------------------------------------\n// 1. INTERCEPTOR DE REQUISIﾃﾃグ (ANEXA O ACCESS TOKEN ANTES DE ENVIAR)\n// -------------------------------------------------------------\naxiosInstance.interceptors.request.use(\n    (config) => {\n        let token = null;\n\n        // 圷 CORREﾃﾃグ DO LOCALSTORAGE: Acesso apenas no lado do cliente\n        if (typeof window !== 'undefined') {\n            token = localStorage.getItem('accessToken');\n        }\n        \n        if (token) {\n            config.headers.Authorization = `Bearer ${token}`;\n        }\n        return config;\n    },\n    (error) => {\n        return Promise.reject(error);\n    }\n);\n\n\n// -------------------------------------------------------------\n// 2. INTERCEPTOR DE RESPOSTA (DETECTA 401 E RENOVA)\n// -------------------------------------------------------------\naxiosInstance.interceptors.response.use(\n  (response) => response,\n  async (error) => {\n    const originalRequest = error.config;\n    const isClient = typeof window !== 'undefined';\n\n    // Verifica se ﾃｩ um 401 E que nﾃ｣o seja a prﾃｳpria requisiﾃｧﾃ｣o de refresh\n    if (error.response?.status === 401 && !originalRequest._retry) {\n      originalRequest._retry = true;\n\n      // Obtﾃｩm o refresh token\n      const REFRESH_TOKEN = isClient ? localStorage.getItem('refreshToken') : null;\n      \n      if (!REFRESH_TOKEN) {\n          return Promise.reject(\"Refresh token nﾃ｣o encontrado. Sessﾃ｣o expirada.\");\n      }\n\n      if (isRefreshing) {\n        // Adiciona requisiﾃｧﾃｵes ﾃ fila\n        return new Promise((resolve, reject) => {\n            failedQueue.push({ resolve, reject });\n        }).then((token: any) => {\n            originalRequest.headers.Authorization = `Bearer ${token}`;\n            return axiosInstance(originalRequest);\n        }).catch(err => {\n            return Promise.reject(err);\n        });\n      }\n\n      isRefreshing = true;\n\n      try {\n        // Envia o refresh token para o endpoint do Django\n        const response = await axios.post(TOKEN_REFRESH_URL, {\n            refresh: REFRESH_TOKEN,\n        });\n\n        const { access: newAccessToken, refresh: newRefreshToken } = response.data;\n\n        // 圷 CORREﾃﾃグ DO LOCALSTORAGE: Salva os novos tokens apenas no cliente\n        if (isClient) {\n            localStorage.setItem('accessToken', newAccessToken);\n            if (newRefreshToken) {\n                 localStorage.setItem('refreshToken', newRefreshToken);\n            }\n        }\n\n        // Atualiza cabeﾃｧalhos\n        axiosInstance.defaults.headers.common['Authorization'] = `Bearer ${newAccessToken}`;\n        originalRequest.headers.Authorization = `Bearer ${newAccessToken}`;\n\n        // Processa a fila e repete a requisiﾃｧﾃ｣o original\n        processQueue(null, newAccessToken);\n        return axiosInstance(originalRequest);\n\n      } catch (refreshError) {\n        // Falha na renovaﾃｧﾃ｣o: Limpa tokens e forﾃｧa logout\n        if (isClient) {\n            localStorage.removeItem('accessToken');\n            localStorage.removeItem('refreshToken');\n        }\n        processQueue(refreshError);\n        return Promise.reject(refreshError);\n      } finally {\n        isRefreshing = false;\n      }\n    }\n\n    return Promise.reject(error);\n  }\n);\n\nexport default axiosInstance;"],"names":[],"mappings":"AAAA,uBAAuB;;;;;AACvB;;AAEA,0DAA0D;AAC1D,MAAM,WAAW;AACjB,MAAM,oBAAoB;AAE1B,6CAA6C;AAC7C,MAAM,wBAAwB;AAE9B,0FAA0F;AAC1F,IAAI,gBAAkB,eAAe,CAAC,aAAa,OAAO,CAAC;;AAI3D,iCAAiC;AACjC,MAAM,gBAAgB,+NAAK,CAAC,MAAM,CAAC;IACjC,SAAS;IACT,SAAS;QACP,gBAAgB;IAClB;AACF;AAEA,wBAAwB;AACxB,IAAI,eAAe;AACnB,IAAI,cAAoF,EAAE;AAE1F,yDAAyD;AACzD,MAAM,eAAe,CAAC,OAAY,QAAuB,IAAI;IAC3D,YAAY,OAAO,CAAC,CAAA;QAClB,IAAI,OAAO;YACT,KAAK,MAAM,CAAC;QACd,OAAO,IAAI,OAAO;YAChB,KAAK,OAAO,CAAC;QACf;IACF;IACA,cAAc,EAAE;AAClB;AAEA,gEAAgE;AAChE,sEAAsE;AACtE,gEAAgE;AAChE,cAAc,YAAY,CAAC,OAAO,CAAC,GAAG,CAClC,CAAC;IACG,IAAI,QAAQ;IAEZ,gEAAgE;IAChE;;IAIA,IAAI,OAAO;QACP,OAAO,OAAO,CAAC,aAAa,GAAG,CAAC,OAAO,EAAE,OAAO;IACpD;IACA,OAAO;AACX,GACA,CAAC;IACG,OAAO,QAAQ,MAAM,CAAC;AAC1B;AAIJ,gEAAgE;AAChE,oDAAoD;AACpD,gEAAgE;AAChE,cAAc,YAAY,CAAC,QAAQ,CAAC,GAAG,CACrC,CAAC,WAAa,UACd,OAAO;IACL,MAAM,kBAAkB,MAAM,MAAM;IACpC,MAAM,WAAW,gBAAkB;IAEnC,sEAAsE;IACtE,IAAI,MAAM,QAAQ,EAAE,WAAW,OAAO,CAAC,gBAAgB,MAAM,EAAE;QAC7D,gBAAgB,MAAM,GAAG;QAEzB,wBAAwB;QACxB,MAAM,gBAAgB,sCAAW,0BAAuC;QAExE,wCAAoB;YAChB,OAAO,QAAQ,MAAM,CAAC;QAC1B;;;IAmDF;IAEA,OAAO,QAAQ,MAAM,CAAC;AACxB;uCAGa","debugId":null}},
    {"offset": {"line": 157, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/esant/OneDrive/%C3%81rea%20de%20Trabalho/costanzaVE-master/frontend-next/src/components/user-fetcher.tsx"],"sourcesContent":["// app/components/UserFetcher.tsx\n\n\"use client\";\n\nimport React, { useState, useEffect } from 'react';\n// Importa a instﾃ｢ncia configurada\nimport axiosInstance from '@/lib/axiosInstance'; \nimport axios from 'axios'; // Importa o Axios para tratamento de erros\n\n// Definiﾃｧﾃ｣o da Tipagem CORRIGIDA para o Objeto de Perfil\ninterface UserProfile {\n  id: number;\n  user: number; \n  nome: string;\n  arroba: string;\n  stack: string;\n  bio: string;\n  skills: string;\n  xp: number;\n  exercicios_concluidos: number;\n  trilhas_concluidas: number;\n  dias_conectados: number;\n}\n\nconst UserFetcher: React.FC = () => {\n  const [profiles, setProfiles] = useState<UserProfile[] | null>(null);\n  const [isLoading, setIsLoading] = useState<boolean>(true);\n  const [error, setError] = useState<string | null>(null);\n\n  // 圷 CORREﾃﾃグ DO 404: O PATH RELATIVO DEVE COMEﾃ②R COM BARRA.\n  const DJANGO_API_PATH: string = '/users/profile/'; \n\n  useEffect(() => {\n    const fetchProfiles = async () => {\n      try {\n        // Usa axiosInstance.get - A autenticaﾃｧﾃ｣o e renovaﾃｧﾃ｣o sﾃ｣o automﾃ｡ticas.\n        const response = await axiosInstance.get(DJANGO_API_PATH);\n        \n        let data = response.data;\n        \n        // Ajuste para garantir que 'data' seja um array\n        if (data && !Array.isArray(data)) {\n            data = [data]; \n        }\n\n        setProfiles(data as UserProfile[]); \n        \n      } catch (err) {\n        let errorMessage = \"Ocorreu um erro desconhecido.\";\n        \n        if (axios.isAxiosError(err)) {\n            if (err.response?.status === 404) {\n                // 圷 Se for 404, confirma problema na URL\n                errorMessage = `Erro 404: O caminho '${DJANGO_API_PATH}' nﾃ｣o foi encontrado no servidor.`;\n            } else if (err.response?.status === 401) {\n                // Se a renovaﾃｧﾃ｣o falhou\n                errorMessage = \"Sessﾃ｣o expirada. O Refresh Token nﾃ｣o conseguiu renovar o acesso. Faﾃｧa login novamente.\";\n            } else if (err.response) {\n                 errorMessage = `Erro HTTP ${err.response.status}: ${JSON.stringify(err.response.data)}`;\n            }\n        } else if (err instanceof Error) {\n            errorMessage = err.message;\n        }\n        \n        setError(errorMessage);\n        \n      } finally {\n        setIsLoading(false);\n      }\n    };\n\n    fetchProfiles();\n  }, []);\n\n  // 3. Renderizaﾃｧﾃ｣o\n  if (isLoading) {\n    return <p>Carregando dados do Django...</p>;\n  }\n\n  if (error) {\n    return (\n      <div style={{ padding: '10px', border: '1px solid red', color: 'red' }}>\n        <h3>Erro ao Carregar Perfis</h3>\n        <p>{error}</p>\n        <p>URL Base: <code>{axiosInstance.defaults.baseURL}</code></p>\n        <p>Caminho Solicitado: <code>{DJANGO_API_PATH}</code></p>\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      <h2>Lista de Perfis (via Django API)</h2>\n      \n      {profiles && profiles.length > 0 ? (\n        <ul>\n          {profiles.map((profile) => (\n            // Renderizaﾃｧﾃ｣o dos dados\n            <li key={profile.id} style={{ marginBottom: '20px', border: '1px solid #ccc', padding: '10px' }}>\n              <strong>ID do Perfil:</strong> {profile.id} <br/>\n              <strong>Nome Completo:</strong> {profile.nome} <br/>\n              <strong>Arroba:</strong> {profile.arroba} <br/>\n              <strong>Stack:</strong> {profile.stack} <br/>\n              <strong>XP:</strong> {profile.xp} <br/>\n              {/* <strong>Dias Conectados:</strong> {profile.dias_conectados} <br/>\n              <strong>Trilhas Concluﾃｭdas:</strong> {profile.trilhas_concluidas} <br/> */}\n              <strong>Skills:</strong> {profile.skills} <br/>\n              <strong>Bio:</strong> {profile.bio} <br/>\n              {/* <strong>Exercﾃｭcios Concluﾃｭdos:</strong> {profile.exercicios_concluidos} */}\n            </li>\n          ))}\n        </ul>\n      ) : (\n        <p>Nenhum perfil encontrado na API.</p>\n      )}\n    </div>\n  );\n}\n\nexport default UserFetcher;"],"names":[],"mappings":"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","debugId":null}}]
}